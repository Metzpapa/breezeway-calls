# breezeway-calls

Interactive branching call flow renderer for cold calling. Hosted on GitHub Pages at:

**https://metzpapa.github.io/breezeway-calls/**

This is a **separate public repo** from the main pipeline (`breezewaycoldemails`). It only contains static assets and JSON data files. No secrets, no API keys, no pipeline code.

---

## Repo Structure

```
breezeway-calls/
├── index.html              # Shell — loads app.js and style.css
├── app.js                  # SPA: PIN gate, search, flow renderer, edit mode
├── style.css               # Dark theme, mobile-first
├── .nojekyll               # Tells GitHub Pages not to use Jekyll
├── data/
│   ├── index.json          # Lightweight lead index for search (no flow data)
│   └── leads/
│       ├── default-framework.json           # Master call flow template
│       ├── dustin-frandsen-moab-lodging-property-management.json
│       └── ...                              # One JSON file per lead
```

## How Data Gets Here

Data flows **one way**: from the main pipeline repo into this repo's `data/` directory.

```
breezewaycoldemails/data/leads.csv
        │
        │  python export_call_flows.py --repo ../breezeway-calls --push
        ▼
breezeway-calls/data/index.json + data/leads/{slug}.json
```

### Step by step:

1. **Generate call flows** in the main pipeline repo:
   ```bash
   cd ~/breezewaycoldemails
   python rerun_briefs.py --remaining --count 20
   ```
   This runs Claude Opus to generate branching JSON flows and saves them into `data/leads.csv` in the `call_brief` column.

2. **Export to this repo**:
   ```bash
   python export_call_flows.py --repo ../breezeway-calls --push
   ```
   This reads `leads.csv`, extracts leads that have branching flows (`call_brief` with `context`/`start`/`nodes`), writes individual JSON files to `data/leads/`, regenerates `data/index.json`, and commits + pushes.

3. **GitHub Pages deploys automatically** — changes appear at the live URL within ~30 seconds of push.

### Important: never run pipeline code from this repo

This repo has no Python, no `.env`, no dependencies. All lead generation and flow generation happens in `breezewaycoldemails`. This repo is purely a static site that renders the output.

---

## Data Formats

### `data/index.json` — Search Index

Lightweight array used by the search page. No flow data included (keeps initial page load fast).

```json
{
  "leads": [
    {
      "slug": "dustin-frandsen-moab-lodging-property-management",
      "name": "Dustin Frandsen",
      "title": "General Manager / Partner",
      "company": "Moab Lodging & Property Management",
      "location": "Moab, UT",
      "phone": "+1-435-633-7033"
    }
  ]
}
```

### `data/leads/{slug}.json` — Per-Lead Flow

Full contact info + branching call flow. Loaded on demand when you open a lead.

```json
{
  "name": "Dustin Frandsen",
  "title": "General Manager / Partner",
  "company": "Moab Lodging & Property Management",
  "location": "Moab, UT",
  "phone": "+1-435-633-7033",
  "company_phone": "+1-800-505-5343",
  "alt_phones": ["+1-435-259-7830"],
  "flow": {
    "context": "3-5 sentence briefing...",
    "start": "opener",
    "nodes": {
      "opener": {
        "label": "OPENER",
        "say": "Exact words to say...",
        "note": "Coaching tip (not spoken).",
        "branches": [
          { "label": "Prospect response", "to": "next_node_id" }
        ]
      }
    }
  }
}
```

Slug format: `slugify(contact_name) + "-" + slugify(company_name)`

### `data/leads/default-framework.json` — Master Template

A generic call flow template (not tied to any lead). Manually created, not generated by the export script. The export script preserves it automatically when regenerating `index.json`.

---

## Edit Mode

The UI has an **Edit** button on each lead page. In edit mode:

- All text fields (say, note, label, branch labels, context) become contenteditable
- Branch targets can be reassigned via a dropdown picker
- Branches can be added/removed, new nodes can be created
- A floating **Save** button commits changes directly to this repo via the GitHub Contents API

First save requires pasting a GitHub token (stored in `localStorage`, never asked again). The token needs `Contents: Read and write` permission on this repo.

---

## PIN Gate

The site requires a PIN on first visit. The PIN hash is stored in `app.js` as a SHA-256 hex string. The actual PIN is stored in the user's browser (`localStorage`) after entry. This is obfuscation, not real security.

---

## Making Changes to the UI

The app is vanilla JS — no build step, no framework, no npm. Edit `app.js` or `style.css`, commit, push, and it's live.

- `app.js` — all logic: routing, rendering, edit mode, GitHub API save
- `style.css` — all styles, CSS variables for theming
- `index.html` — minimal shell, rarely needs changes
